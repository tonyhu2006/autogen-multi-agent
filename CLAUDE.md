# AutoGen多代理系统开发规范

## 🔄 项目感知与上下文
- **始终阅读 `PLANNING.md`** 以了解项目架构、目标和约束
- **检查 `TASK.md`** 确认当前任务状态和优先级
- **使用一致的命名约定、文件结构和架构模式**
- **应用Context-Engineering的认知工具和协议Shell**

## 🧠 认知工具集成
- **使用IBM认知工具** 进行问题分解和分析
- **应用结构化推理模式** 识别代理交互模式
- **利用元认知能力** 进行系统自我监控和优化
- **实施字段共振机制** 确保代理间通信一致性

## 🤖 AutoGen框架规范
- **使用AutoGen的ConversableAgent** 作为基础代理类
- **实现GroupChat和GroupChatManager** 管理多代理协作
- **配置适当的LLM模型** (OpenAI GPT-4或Azure OpenAI)
- **使用function_map注册工具函数** 实现外部API集成
- **实现human_input_mode控制** 用户交互和确认机制

## 🛠️ 代码结构与模块化
- **单文件不超过500行代码**，超出时进行模块化拆分
- **按功能组织代码模块**：
  ```
  agents/
  ├── research_agent.py    # 研究代理实现
  ├── email_agent.py       # 邮件代理实现
  ├── coordinator.py       # 代理协调器
  └── base_agent.py        # 基础代理类
  
  tools/
  ├── search_tools.py      # 搜索工具函数
  ├── email_tools.py       # 邮件工具函数
  └── cognitive_tools.py   # 认知工具集成
  
  protocols/
  ├── communication.py     # 代理通信协议
  ├── error_handling.py    # 错误处理机制
  └── field_resonance.py   # 字段共振实现
  ```

## 🧪 测试与可靠性
- **为每个代理创建单元测试** 验证核心功能
- **实现集成测试** 验证代理间协作
- **创建端到端测试** 验证完整工作流程
- **使用pytest框架** 组织和执行测试
- **测试覆盖率目标：>90%**

## 🔧 外部API集成
- **Brave Search API**：
  - 使用异步请求提高性能
  - 实现请求限制和重试机制
  - 处理API响应错误和超时
- **Gmail API**：
  - 实现OAuth2认证流程
  - 支持邮件草稿创建和发送
  - 处理附件和HTML格式
- **环境变量管理**：
  - 使用python-dotenv加载配置
  - 敏感信息存储在.env文件
  - 提供配置验证和默认值

## 📋 协议Shell应用
- **通信协议**：定义代理间标准化消息格式
- **错误恢复协议**：实现自动错误检测和恢复
- **学习协议**：支持代理从交互中学习和改进
- **安全协议**：确保API密钥和用户数据安全

## ✅ 任务完成标准
- **标记完成的任务** 在`TASK.md`中更新状态
- **记录新发现的子任务** 添加到"开发过程中发现"部分
- **更新文档** 反映代码变更和新功能
- **运行完整测试套件** 确保所有测试通过

## 📎 代码风格与约定
- **使用Python 3.9+** 作为主要开发语言
- **遵循PEP8规范** 使用black格式化代码
- **使用类型提示** 提高代码可读性和IDE支持
- **使用pydantic** 进行数据验证和序列化
- **为每个函数编写docstring** 使用Google风格：
  ```python
  def example_function(param1: str, param2: int) -> dict:
      """
      函数简要描述。

      Args:
          param1 (str): 参数1描述
          param2 (int): 参数2描述

      Returns:
          dict: 返回值描述

      Raises:
          ValueError: 错误条件描述
      """
  ```

## 🔍 认知增强开发流程
1. **需求认知分析**：使用认知工具深度理解需求
2. **架构协议设计**：应用协议Shell设计系统架构
3. **渐进式实现**：从原子级功能到完整系统
4. **字段共振验证**：确保组件间一致性和协调性
5. **自修复测试**：验证系统的错误恢复能力
6. **元认知优化**：基于运行反馈持续改进系统

## 📚 文档与可解释性
- **为每个代理编写详细文档** 说明功能和交互方式
- **记录协议Shell的应用** 解释设计决策和实现细节
- **提供使用示例** 展示系统的典型使用场景
- **维护API文档** 使用docstring自动生成文档
